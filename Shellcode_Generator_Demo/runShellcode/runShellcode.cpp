#include <windows.h>

void testShellcodeRun()
{
	unsigned char shellcode[] = "\x55\x8b\xec\x83\xec\x08\xe8\x2c\x00\x00\x00\x89\x45\xfc\x8b\x45\xfc\x25\x00\xf0\xff\xff\x89\x45\xf8\x8b\x4d\xf8\x51\xe8\x1d\x00\x00\x00\x83\xc4\x04\x8b\x55\x08\x52\xe8\x8e\x03\x00\x00\x83\xc4\x04\x33\xc0\x8b\xe5\x5d\xc3\x55\x8b\xec\x8b\x45\x04\x5d\xc3\x55\x8b\xec\x83\xec\x44\xc7\x45\xd8\x2c\x04\x00\x00\xc7\x45\xcc\x44\x04\x00\x00\x81\x7d\xd8\x99\x99\x99\x99\x74\x3f\x8b\x45\xd8\x89\x45\xf4\xeb\x09\x8b\x4d\xf4\x83\xc1\x02\x89\x4d\xf4\x8b\x55\xf4\x3b\x55\xcc\x77\x26\x0f\xae\xe8\x8b\x45\x08\x03\x45\xf4\x0f\xb7\x08\x8b\x55\x08\x8b\x04\x0a\x03\x45\x08\x8b\x4d\x08\x03\x4d\xf4\x0f\xb7\x11\x8b\x4d\x08\x89\x04\x11\xeb\xc9\xc7\x45\xd4\x2c\x04\x00\x00\xc7\x45\xe0\x2c\x04\x00\x00\x81\x7d\xd4\x77\x77\x77\x77\x0f\x84\x27\x01\x00\x00\xe8\x26\x01\x00\x00\x8b\x55\x08\x03\x55\xd4\x89\x55\xf8\xc7\x45\xdc\x01\x00\x00\x00\xc7\x45\xe8\x00\x00\x00\x00\xb8\x01\x00\x00\x00\x85\xc0\x0f\x84\xfe\x00\x00\x00\x83\x7d\xdc\x00\x74\x5d\x8b\x4d\xf8\x89\x4d\xe4\x8b\x55\xe4\x52\xff\x15\xd4\x03\x00\x00\x89\x45\xe8\x83\x7d\xe8\x00\x75\x0d\x8b\x45\xe4\x50\xff\x15\xd8\x03\x00\x00\x89\x45\xe8\x8b\x4d\xe4\x89\x4d\xf0\x8b\x55\xf0\x83\xc2\x01\x89\x55\xc8\x8b\x45\xf0\x8a\x08\x88\x4d\xfe\x83\x45\xf0\x01\x80\x7d\xfe\x00\x75\xee\x8b\x55\xf0\x2b\x55\xc8\x89\x55\xc4\x8b\x45\xc4\x8b\x4d\xf8\x8d\x54\x01\x01\x89\x55\xf8\x8b\x45\xf8\x8a\x08\x88\x4d\xff\x0f\xb6\x55\xff\x83\xfa\x2c\x75\x68\x8b\x45\xf8\x83\xc0\x01\x89\x45\xd0\x8b\x4d\xd0\x51\x8b\x55\xe8\x52\xff\x15\xdc\x03\x00\x00\x8b\x4d\x08\x03\x4d\xe0\x89\x01\x8b\x55\xe0\x83\xc2\x04\x89\x55\xe0\x8b\x45\xd0\x89\x45\xec\x8b\x4d\xec\x83\xc1\x01\x89\x4d\xc0\x8b\x55\xec\x8a\x02\x88\x45\xfd\x83\x45\xec\x01\x80\x7d\xfd\x00\x75\xee\x8b\x4d\xec\x2b\x4d\xc0\x89\x4d\xbc\x8b\x55\xbc\x8b\x45\xf8\x8d\x4c\x10\x02\x89\x4d\xf8\xc7\x45\xdc\x00\x00\x00\x00\xeb\x1d\x0f\xb6\x55\xff\x83\xfa\x3b\x75\x12\x8b\x45\xf8\x83\xc0\x01\x89\x45\xf8\xc7\x45\xdc\x01\x00\x00\x00\xeb\x02\xeb\x05\xe9\xf5\xfe\xff\xff\x8b\xe5\x5d\xc3\x55\x8b\xec\x51\xe8\x39\x00\x00\x00\x89\x45\xfc\xe8\x6f\x00\x00\x00\xa3\xdc\x03\x00\x00\x68\xe0\x03\x00\x00\x8b\x45\xfc\x50\xff\x15\xdc\x03\x00\x00\xa3\xd4\x03\x00\x00\x68\xf4\x03\x00\x00\x8b\x4d\xfc\x51\xff\x15\xdc\x03\x00\x00\xa3\xd8\x03\x00\x00\x8b\xe5\x5d\xc3\x55\x8b\xec\x83\xec\x08\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\xc7\x45\xf8\x00\x00\x00\x00\x64\xa1\x30\x00\x00\x00\x8b\x40\x0c\x8b\x40\x14\x8b\x00\x8b\x00\x8b\x40\x10\x89\x45\xf8\x8b\x45\xf8\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x8b\xe5\x5d\xc3\x55\x8b\xec\x83\xec\x50\xe8\xb7\xff\xff\xff\x89\x45\xf8\x8b\x45\xf8\x89\x45\xd8\x8b\x4d\xd8\x8b\x51\x3c\x03\x55\xf8\x89\x55\xd4\x8b\x45\xd4\x83\xc0\x78\x89\x45\xd0\x8b\x4d\xd0\x8b\x55\xf8\x03\x11\x89\x55\xf0\x8b\x45\xf0\x8b\x48\x14\x89\x4d\xcc\x8b\x55\xf0\x8b\x42\x18\x89\x45\xc8\x8b\x4d\xf0\x8b\x51\x1c\x03\x55\xf8\x89\x55\xe0\x8b\x45\xf0\x8b\x48\x20\x03\x4d\xf8\x89\x4d\xc0\x8b\x55\xf0\x8b\x42\x24\x03\x45\xf8\x89\x45\xc4\xc7\x45\xf4\x00\x00\x00\x00\xeb\x09\x8b\x4d\xf4\x83\xc1\x01\x89\x4d\xf4\x8b\x55\xf4\x3b\x55\xcc\x0f\x83\xcf\x00\x00\x00\x8b\x45\xf4\x8b\x4d\xe0\x83\x3c\x81\x00\x75\x02\xeb\xdd\x8b\x55\xf4\x8b\x45\xe0\x8b\x0c\x90\x89\x4d\xb0\xc7\x45\xec\x00\x00\x00\x00\xeb\x09\x8b\x55\xec\x83\xc2\x01\x89\x55\xec\x8b\x45\xec\x3b\x45\xc8\x0f\x83\x92\x00\x00\x00\x8b\x4d\xec\x8b\x55\xc4\x0f\xb7\x04\x4a\x3b\x45\xf4\x75\x7e\x0f\xae\xe8\x8b\x4d\xec\x8b\x55\xc0\x8b\x04\x8a\x89\x45\xbc\x8b\x4d\xf8\x03\x4d\xbc\x89\x4d\xb8\xc7\x45\xe4\x04\x04\x00\x00\x8b\x55\xb8\x89\x55\xe8\x8b\x45\xe8\x8a\x08\x88\x4d\xff\x8b\x55\xe4\x3a\x0a\x75\x2e\x80\x7d\xff\x00\x74\x1f\x8b\x45\xe8\x8a\x48\x01\x88\x4d\xfe\x8b\x55\xe4\x3a\x4a\x01\x75\x17\x83\x45\xe8\x02\x83\x45\xe4\x02\x80\x7d\xfe\x00\x75\xcc\xc7\x45\xdc\x00\x00\x00\x00\xeb\x08\x1b\xc0\x83\xc8\x01\x89\x45\xdc\x8b\x4d\xdc\x89\x4d\xb4\x83\x7d\xb4\x00\x75\x08\x8b\x45\xb0\x03\x45\xf8\xeb\x0a\xe9\x59\xff\xff\xff\xe9\x1c\xff\xff\xff\x8b\xe5\x5d\xc3\x55\x8b\xec\x68\x14\x04\x00\x00\x6a\x00\xff\x15\x0c\x00\x00\x00\x83\xc4\x08\x5d\xc3\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x47\x65\x74\x4d\x6f\x64\x75\x6c\x65\x48\x61\x6e\x64\x6c\x65\x41\x00\x00\x00\x00\x4c\x6f\x61\x64\x4c\x69\x62\x72\x61\x72\x79\x41\x00\x00\x00\x00\x47\x65\x74\x50\x72\x6f\x63\x41\x64\x64\x72\x65\x73\x73\x00\x00\x48\x65\x6c\x6c\x6f\x20\x57\x6f\x72\x6c\x64\x3a\x20\x73\x68\x65\x6c\x6c\x63\x6f\x64\x65\x00\x00\xc0\x03\x02\x02\x04\x01\x66\x01\x07\x02\x4b\x03\x0c\x02\xf1\x00\xf3\x01\x16\x02\xf8\x01\x1b\x02";

	void * mem = VirtualAlloc(NULL, 0x3000, MEM_COMMIT, PAGE_EXECUTE_READWRITE);

	if (mem != 0)
	{
		memcpy(mem, shellcode, 0x444);
		void(*func)(char*);
		func = (void(*)(char*))mem;
		func((char*)"sam666");
	}
}

int main(LPVOID param)
{
	testShellcodeRun();
	return 0;
}